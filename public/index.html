<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìö Biblioth√®que</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage">
        <div class="login-container">
            <div class="login-header">
                <div class="logo">üìö</div>
                <h1>Biblioth√®que</h1>
                <p>G√©rez vos emprunts en toute simplicit√©</p>
            </div>
            
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="showLoginTab()">Connexion</button>
                <button class="auth-tab" onclick="showRegisterTab()">Inscription</button>
            </div>
            
            <!-- Login Form -->
            <form id="loginForm" class="auth-form">
                <input type="email" id="loginEmail" placeholder="Email" required>
                <input type="password" id="loginPassword" placeholder="Mot de passe" required>
                <button type="submit">Se connecter</button>
                <div id="loginError" class="error-msg"></div>
            </form>
            
            <!-- Register Form -->
            <form id="registerForm" class="auth-form hidden">
                <input type="text" id="registerName" placeholder="Nom complet" required>
                <input type="email" id="registerEmail" placeholder="Email" required>
                <input type="password" id="registerPassword" placeholder="Mot de passe" required>
                <button type="submit">S'inscrire</button>
                <div id="registerError" class="error-msg"></div>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-brand">
                <div class="logo">üìö</div>
                <h2>Biblioth√®que</h2>
            </div>
            
            <nav class="sidebar-menu">
                <button class="menu-item active" data-tab="books">
                    <span class="icon">üìñ</span>
                    <span>Catalogue</span>
                </button>
                <button class="menu-item" onclick="openRequestModal()">
                    <span class="icon">‚ûï</span>
                    <span>Emprunter</span>
                </button>
                <button class="menu-item" data-tab="myborrow">
                    <span class="icon">üìã</span>
                    <span>Mes Emprunts</span>
                </button>
                <button class="menu-item" data-tab="notifications">
                    <span class="icon">üîî</span>
                    <span>Notifications</span>
                    <span class="badge" id="notificationsCount">0</span>
                </button>
                <button class="menu-item librarian-only" data-tab="active-loans">
                    <span class="icon">üìö</span>
                    <span>Emprunts Actifs</span>
                    <span class="badge" id="activeLoansCount">0</span>
                </button>
                <button class="menu-item librarian-only" data-tab="pending">
                    <span class="icon">‚è≥</span>
                    <span>Demandes</span>
                    <span class="badge" id="pendingCount">0</span>
                </button>
                <button class="menu-item librarian-only" data-tab="addbook">
                    <span class="icon">‚ûï</span>
                    <span>Ajouter Livre</span>
                </button>
                <button class="menu-item admin-only" data-tab="users">
                    <span class="icon">üë•</span>
                    <span>Utilisateurs</span>
                </button>
            </nav>
            
            <div class="sidebar-user">
                <div class="user-avatar" id="userAvatar">U</div>
                <div class="user-info">
                    <div class="user-name" id="userName">User</div>
                    <div class="user-role" id="userRole">Member</div>
                </div>
                <button class="btn-logout" onclick="logout()" title="D√©connexion">üö™</button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Books Tab -->
            <section id="books" class="content-section active">
                <div class="section-header">
                    <div>
                        <h1>üìñ Catalogue</h1>
                        <p>Parcourez notre collection</p>
                    </div>
                    <input type="text" id="searchInput" class="search-bar" placeholder="üîç Rechercher..." onkeyup="filterBooks()">
                </div>
                <div id="booksList" class="books-grid">
                    <div class="loader">Chargement...</div>
                </div>
            </section>

            <!-- My Borrowings Tab -->
            <section id="myborrow" class="content-section">
                <div class="section-header">
                    <h1>üìã Mes Emprunts</h1>
                    <p>Suivez l'√©tat de vos demandes</p>
                </div>
                <div id="myBorrowingsList" class="borrowings-list">
                    <div class="loader">Chargement...</div>
                </div>
            </section>

            <!-- Active Loans Tab (Librarian/Admin Only) -->
            <section id="active-loans" class="content-section librarian-only">
                <div class="section-header">
                    <div>
                        <h1>üìö Emprunts Actifs</h1>
                        <p>Tous les livres actuellement emprunt√©s</p>
                    </div>
                    <button class="btn-refresh" onclick="loadActiveLoans()">üîÑ Actualiser</button>
                </div>
                <div id="activeLoansList" class="loans-list">
                    <div class="loader">Chargement...</div>
                </div>
            </section>

            <!-- Pending Requests Tab -->
            <section id="pending" class="content-section librarian-only">
                <div class="section-header">
                    <div>
                        <h1>‚è≥ Demandes en Attente</h1>
                        <p>G√©rez les demandes d'emprunt</p>
                    </div>
                    <button class="btn-refresh" onclick="loadPendingRequests()">üîÑ Actualiser</button>
                </div>
                <div id="pendingList" class="requests-list">
                    <div class="loader">Chargement...</div>
                </div>
            </section>

            <!-- Notifications Tab -->
            <section id="notifications" class="content-section">
                <div class="section-header">
                    <div>
                        <h1>üîî Notifications</h1>
                        <p>Restez inform√© de vos emprunts</p>
                    </div>
                    <div>
                        <button class="btn-secondary" onclick="markAllNotificationsAsRead()">‚úì Tout marquer comme lu</button>
                        <button class="btn-refresh" onclick="loadNotifications()">üîÑ Actualiser</button>
                    </div>
                </div>
                <div id="notificationsList" class="notifications-list">
                    <div class="loader">Chargement...</div>
                </div>
            </section>

            <!-- Add Book Tab -->
            <section id="addbook" class="content-section librarian-only">
                <div class="section-header">
                    <h1>‚ûï Ajouter un Livre</h1>
                    <p>Enrichissez le catalogue</p>
                </div>
                <div class="add-book-container">
                    <form class="book-form" onsubmit="event.preventDefault(); addBook();">
                        <div class="form-grid">
                            <div class="form-field">
                                <label>Titre</label>
                                <input type="text" id="bookTitle" placeholder="ex: Le Petit Prince" required>
                            </div>
                            <div class="form-field">
                                <label>Auteur</label>
                                <input type="text" id="bookAuthor" placeholder="ex: Antoine de Saint-Exup√©ry" required>
                            </div>
                            <div class="form-field">
                                <label>Genre</label>
                                <select id="bookGenre" required>
                                    <option value="">S√©lectionner</option>
                                    <option value="Roman">Roman</option>
                                    <option value="Science-Fiction">Science-Fiction</option>
                                    <option value="Fantasy">Fantasy</option>
                                    <option value="Classique">Classique</option>
                                    <option value="Conte">Conte</option>
                                    <option value="Dystopie">Dystopie</option>
                                    <option value="Aventure">Aventure</option>
                                    <option value="Histoire">Histoire</option>
                                </select>
                            </div>
                            <div class="form-field">
                                <label>URL Couverture</label>
                                <input type="url" id="bookCover" placeholder="https://...">
                            </div>
                            <div class="form-field">
                                <label>Quantit√© totale</label>
                                <input type="number" id="bookQuantity" min="1" value="1" required>
                            </div>
                        </div>
                        <button type="submit" class="btn-primary">‚ûï Ajouter le livre</button>
                    </form>
                    <div id="addBookResult"></div>
                </div>
            </section>

            <!-- Users Management Tab (Admin Only) -->
            <section id="users" class="content-section admin-only">
                <div class="section-header">
                    <div>
                        <h1>üë• Gestion des Utilisateurs</h1>
                        <p>G√©rez les r√¥les des membres</p>
                    </div>
                    <button class="btn-refresh" onclick="loadUsers()">üîÑ Actualiser</button>
                </div>
                <div id="usersList" class="users-list">
                    <div class="loader">Chargement...</div>
                </div>
            </section>
        </main>

        <!-- Modal Edit Book -->
        <div id="editModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>‚úèÔ∏è Modifier le livre</h2>
                    <button class="modal-close" onclick="closeEditModal()">‚úï</button>
                </div>
                <form class="book-form" onsubmit="event.preventDefault(); updateBook();">
                    <input type="hidden" id="editBookId">
                    <div class="form-grid">
                        <div class="form-field">
                            <label>Titre</label>
                            <input type="text" id="editBookTitle" required>
                        </div>
                        <div class="form-field">
                            <label>Auteur</label>
                            <input type="text" id="editBookAuthor" required>
                        </div>
                        <div class="form-field">
                            <label>Genre</label>
                            <select id="editBookGenre" required>
                                <option value="">S√©lectionner</option>
                                <option value="Roman">Roman</option>
                                <option value="Science-Fiction">Science-Fiction</option>
                                <option value="Fantasy">Fantasy</option>
                                <option value="Classique">Classique</option>
                                <option value="Conte">Conte</option>
                                <option value="Dystopie">Dystopie</option>
                                <option value="Aventure">Aventure</option>
                                <option value="Histoire">Histoire</option>
                            </select>
                        </div>
                        <div class="form-field">
                            <label>URL Couverture</label>
                            <input type="url" id="editBookCover">
                        </div>
                        <div class="form-field">
                            <label>Quantit√© totale</label>
                            <input type="number" id="editBookQuantity" min="1" required>
                        </div>
                    </div>
                    <button type="submit" class="btn-primary">üíæ Enregistrer</button>
                </form>
            </div>
        </div>

        <!-- Modal Request Book -->
        <div id="requestModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üìñ Emprunter un livre</h2>
                    <button class="modal-close" onclick="closeRequestModal()">‚úï</button>
                </div>
                <input type="text" class="search-bar" placeholder="üîç Rechercher..." onkeyup="filterBooksInModal()" style="width: 100%; margin-bottom: 16px;">
                <div id="bookSelectList" class="book-select-list">
                    <div class="loader">Chargement...</div>
                </div>
                <button class="btn-primary" onclick="confirmBookRequest()" style="margin-top: 16px;" id="confirmRequestBtn" disabled>
                    Confirmer l'emprunt
                </button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>